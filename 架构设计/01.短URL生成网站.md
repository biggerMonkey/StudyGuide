# 1.引言

## 1.1 项目背景



## 1.2. 参考资料

*【项目的**BRD**文档地址：链接】*

*【项目的主**PRD**文档地址：链接】*

*【项目的子**PRD**文档地址：链接】*

*【项目的总体设计文档：链接】*

*【项目所涉及到的应用：应用的**Git**地址】*

*【参考的开源信息：博文地址】*

## 1.3. 名词解释

*【描述本文档中会涉及到术语或缩略语的定义】*

| **缩写或者术语** | **解释** |
| ---------------- | -------- |
|                  |          |

# 2.设计目标

## 2.1.功能清单

*【描述需要实现的功能清单，可以按照系统、模块、接口维度进行描述】*

## 2.2 .设计考虑

*【罗列本设计文档需要重点考虑的技术点，比如：**ToC**接口的性能、数据一致性、容错处理、安全性、限流策略、降级策略、接口兼容性、运用设计模式保证* *扩展性、上线时进行数据初始化等】*

## 2.3. 性能目标

*【接口的性能指标，**MQ**消费的**TPS**等，可以参考同性质接口当前的性能表现，这些指标将作为压测标准】*

| **接口名**       | **分类**   | **重要级别** | **TP90(≤)** | **TP99(≤)** | **TP999(≤)** | **TPS** |
| ---------------- | ---------- | ------------ | ----------- | ----------- | ------------ | ------- |
| 比如查询用户权益 | ToC或者ToB | 第1类        | 10ms        | 20ms        | 40ms         |         |

# 3. 系统概要设计

## 3.1. 系统的整体架构

*【描述系统的整体架构】*

## 3.2. 系统模块划分

*【描述该系统的功能模块划分情况，并说明每一个功能模块需要实现的业务功能】*

## 3.3. 全局数据结构说明

*【比如核心数据模型中的单据状态枚举说明、以及一些核心概念】*

# 4. 数据库设计

## 4.1. 数据关系模型图

*【数据关系模型图：用来描述表之间的关系，侧重主键之间的关系说明】*

### 4.1.1. 中文表名（英文表名）

#### 4.1.1.1. 所属数据库

数据库名：XXXXX

#### 4.1.1.2. 表结构

| **中文名** | **字段名** | **可空** | **类型**   | **唯一性** | **缺省性** | **备注** |
| ---------- | ---------- | -------- | ---------- | ---------- | ---------- | -------- |
| 记录id     | id         | 否       | bigint(20) |            |            | 主键     |

#### 4.1.1.3. 索引说明 

| **索引名** | **相关字段** | **索引类型**            | **索引方法** |
| ---------- | ------------ | ----------------------- | ------------ |
| idx_XXXX   |              | Normal/Unique/Full Text | BTree/Hash   |

## 4.2. 缓存设计

| **名称** | **类型** | **过期时间** | **数据量级（M）** | **备注说明** |
| -------- | -------- | ------------ | ----------------- | ------------ |
|          |          |              | 条数*每条容量     | 缓存用途说明 |

## 4.3. ES索引设计

### 4.3.1. 索引名称

#### 4.3.1.1. 索引整体说明

| **描述项**     | **内容** |
| -------------- | -------- |
| 索引的作用描述 |          |
| 索引名称       |          |
| 索引Type       |          |
| Shard分片数量  | 几个分片 |
| Replica数量    | 几个副本 |

#### 4.3.1.2. 字段说明

| **字段** | **类型** | **备注** |
| -------- | -------- | -------- |
|          |          |          |

对应的mapping.json文件说明：

{

"properties":{

"product_id": {

"type": "long",

"index": "not_analyzed" },

}

}

# 5. 接口设计

## 5.1. 接口名称

### 5.1.1. 接口描述

*【接口的功能描述，在什么场景调用，**ToC**还是**ToB**，调用方包括哪些系统，接口地址】*

| **描述项** | **内容**                     |
| ---------- | ---------------------------- |
| 功能描述   |                              |
| 调用场景   |                              |
| 接口性质   | ToC 还是 ToB                 |
| 调用方     | 包括哪些上游系统             |
| 接口地址   | Rest接口的URL或者RPC方法路径 |

### 5.1.2. 接口定义

#### 5.1.2.1. 输入参数说明

| **参数名** | **数据类型** | **是否必填** | **参数说明**         |
| ---------- | ------------ | ------------ | -------------------- |
|            |              |              | 默认值、取值范围说明 |

#### 5.1.2.2. 输出参数说明

| **参数名** | **数据类型** | **是否必填** | **参数说明** |
| ---------- | ------------ | ------------ | ------------ |
|            |              |              |              |

#### 5.1.2.3. 错误码定义

| **错误码** | **错误码说明** |
| ---------- | -------------- |
|            |                |

### 5.1.3. 接口逻辑说明

*【将接口的核心逻辑按照执行顺序进行文字说明，如果存在很多逻辑分支，请采用流程图进行表述】*

### 5.1.4. 其他考虑

*【限流策略、降级策略】*

# 6. MQ设计

## 6.1. 主题中文名称

### 6.1.1. 主题定义

| **描述项**     | **内容**                                 |
| -------------- | ---------------------------------------- |
| 主题的作用说明 |                                          |
| MQ选型         | RocketMQ、Kafka                          |
| Topbic         |                                          |
| 生产者         | 中文组名（英文组名）                     |
| 消费者         | 中文组名（英文组名）                     |
| 消费方式       | 集群消费还是广播消费、推或者批量拉取策略 |
| 备用说明       |                                          |
| **Tags名称**   | **说明**                                 |
|                |                                          |

### 6.1.2. 设计考虑

*【消息乱序的考虑、高并发下分布式锁的考虑、幂等设计：需要给出具体的方案】*

# 7. 定时任务设计

## 7.1. 任务中文名称

### 7.1.1. 任务定义

| **描述项**     | **内容** |
| -------------- | -------- |
| 任务说明       |          |
| Cron表达式     |          |
| Cron表达式说明 |          |

### 7.1.2. 具体逻辑

*【将任务的核心逻辑按照执行顺序进行文字说明，如果存在很多逻辑分支，请采用流程图进行表述】*

# 8. 埋点和数据统计

## 8.1. 埋点格式说明

*【列出埋点日志的示例并给出字段说明】*

## 8.2. 数据统计的实现方案

*【考虑实时和离线数据的方案】*

# 9. 容错设计

*【依赖资源不可用时的重试机制】*

# 10. 系统安全设计

*【系统的安全策略：比如**token**机制、权限验证、**https**、安全审计日志】*

# 11. 其他设计

*【比如疑难问题的运维工具建设】*

# 12 系统改动清单

## 12.1 RPC接口新增/修改清单

| **应用** | **版本** | **接口名** | **方法名** | **是否新增** | **支持HTTP** | **功能描述** |
| -------- | -------- | ---------- | ---------- | ------------ | ------------ | ------------ |
| bizbase  | 1.0.31   | IXXXX      | queryXX    | Yse          | No           | 查询XXX      |
|          |          |            |            |              |              |              |
|          |          |            |            |              |              |              |

# 13. 工作量评估

| **模块** | **任务** | **工时（人日）** | **负责人** | **合计（人日）** | **备注** |
| -------- | -------- | ---------------- | ---------- | ---------------- | -------- |
|          |          |                  |            |                  |          |
|          |          |                  |            |                  |          |
|          |          |                  |            |                  |          |
| 总计     |          |                  |            |                  |          |

# 14. 上线计划

| **序号** | **分类** | **检查项**         | **具体操作**                             | **链接** |
| -------- | -------- | ------------------ | ---------------------------------------- | -------- |
| **序号** | **分类** | **检查项**         | **具体操作**                             | **链接** |
| 1        | 数据库   | 表结构变化         | 建表，加字段，改索引                     |          |
| 2        |          | 机器访问数据库授权 |                                          |          |
| 3        |          | 初始化             |                                          |          |
| 4        | MQ       | 生产者             |                                          |          |
| 5        |          | 消费者             |                                          |          |
| 6        | 配置中心 | 命名空间A          | 增加哪些配置项                           |          |
| 7        |          | 命名空间B          | 增加哪些配置项                           |          |
| 8        | 服务调用 | 申请调用链         | 1.    A→B  2.    B→C                     |          |
| 9        | 上线顺序 | 上线顺序           | 1.    服务A  2.    服务B  3.    前端上线 |          |
| 10       | 线上校验 | 线上校验           | 1.    校验项                             |          |
| 11       | 回滚方案 | 回滚方案           | 1.    服务A失败，回滚服务A               |          |

 

# 15. 项目复盘

 